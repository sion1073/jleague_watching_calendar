# データエクスポート機能実装 議事録

**日付**: 2026-02-25

---

## 質問

jleague_watching_calendarの開発をおこないます。
議事録から過去の状況は確認してください。

データのエクスポート機能について実装を開始します。

---

## 回答

議事録と現在のコードベースを確認しました。

*2026-02-16_02.md, ai_chat_log の各ファイル, pubspec.yaml を確認*
*app_drawer.dart, season.dart, match_result.dart, season_service.dart を確認*

過去の状況:
- スライドメニュー（AppDrawer）が実装済みで、データエクスポートは「未実装」スタブとして存在
- `SeasonService.exportAllData()` が既に実装済みで、全シーズンをJSON形式に変換する機能あり
- モデル（Season, MatchResult）にも `toJson()` / `fromJson()` が実装済み

出力形式: JSON、ブラウザダウンロード機能を使用することを確認しました。

実装内容:

### 1. ExportService の作成

新規ファイル `lib/services/export_service.dart` を作成。

- `dart:js_interop` と `package:web` を使用（`dart:html` は非推奨のため）
- `exportToJson()` メソッドでタイムスタンプ付きのファイル名でJSONをダウンロード
  - ファイル名形式: `jleague_data_YYYYMMDD_HHmmss.json`
  - Blobを作成しObjectURLで `<a>` タグ経由でダウンロード

### 2. pubspec.yaml の更新

`package:web` を依存に追加（`web: ^1.1.0`）。

### 3. app_drawer.dart の更新

- `ExportService` をインポート
- データエクスポートの `ListTile` を有効化（`enabled: false` と `未実装` サブタイトルを削除）
- `_handleExport()` メソッドを追加
  - ドロワーを閉じる
  - `ExportService.exportToJson()` を呼び出す
  - 成功/失敗をSnackBarで通知

*flutter analyze で検証*

### 検証結果

```bash
flutter analyze
```

**結果**: 2 issues found（既存のinfo警告のみ、今回の実装に関するエラーなし）

---

## 実装完了項目

1. **ExportService の作成**
   - `lib/services/export_service.dart`
   - `package:web` + `dart:js_interop` を使用したブラウザダウンロード実装

2. **pubspec.yaml の更新**
   - `web: ^1.1.0` を依存に追加

3. **app_drawer.dart の更新**
   - データエクスポートのListTileを有効化
   - `_handleExport()` メソッドを追加

## 変更ファイル

- **新規作成**:
  - `lib/services/export_service.dart`

- **変更**:
  - `pubspec.yaml` - `package:web` 依存を追加
  - `lib/widgets/app_drawer.dart` - エクスポート機能を有効化

---

**最終結果**:
- ✅ スライドメニュー「データエクスポート」をタップするとJSONファイルがダウンロードされる
- ✅ ファイル名にタイムスタンプが付く（`jleague_data_YYYYMMDD_HHmmss.json`）
- ✅ `dart:html`非推奨警告なし
- ✅ flutter analyzeで新規エラーなし
