# チームデータ更新・対戦相手リーグ絞り込み設定 議事録

**日付**: 2026-03-02

---

## 質問

jleague_watching_calendarの開発をおこないます。
議事録から過去の状況は確認してください。

team_constants.dartのhomeTeamsって今も参照してましたっけ（設定画面に設定が移行しましたが）

---

## 回答

*team_constants.dart, preferences_service.dart, settings_screen.dart, match_form_screen.dart を確認*

`homeTeams`（`team_constants.dart` の定数）は現在も **1か所で参照されています**：

**`preferences_service.dart:39`**
```dart
return teams ?? List<String>.from(homeTeams);
```

`getHomeTeams()` のフォールバック（SharedPreferencesに未保存の場合のデフォルト値）として使われています。ユーザーが設定画面で何も変更していない初回起動時に `['FC東京', '鹿島アントラーズ', '日本代表']` が返ります。

それ以外の `homeTeams` という変数名は、`search_screen.dart`、`settings_screen.dart`、`match_form_screen.dart` にも出ていますが、これらはすべてローカル変数（`_preferencesService.getHomeTeams()` の戻り値を受けたもの）で、`team_constants.dart` の定数とは無関係です。

`team_constants.dart` の `homeTeams` 定数は `preferences_service.dart` のデフォルト値としてのみ使用されており、削除するとデフォルト値がなくなります。実質的には「設定未保存時のハードコードされたデフォルト」という役割に限定されています。

---

## 質問

なるほど。デフォルトの設定ですか。問題なさそうなので日本代表だけにしておきました。

各リーグのチームについて、2026-2027シーズンの情報で更新してください。

---

## 回答

*Jリーグ公式サイトから2026シーズンのクラブ一覧を取得*

*team_constants.dart を更新*

2026シーズンの情報に更新しました。

**J1（20クラブ）**
- 追加: 水戸ホーリーホック、ジェフユナイテッド千葉、FC町田ゼルビア、東京ヴェルディ、ファジアーノ岡山、V・ファーレン長崎
- 削除: 北海道コンサドーレ札幌、湘南ベルマーレ、ジュビロ磐田、サガン鳥栖、アルビレックス新潟

**J2（20クラブ）**
- 追加: 北海道コンサドーレ札幌、ヴァンラーレ八戸、いわきFC、栃木シティ、RB大宮アルディージャ、湘南ベルマーレ、アルビレックス新潟、ジュビロ磐田、サガン鳥栖、テゲバジャーロ宮崎
- 削除: 水戸ホーリーホック、栃木SC、大宮アルディージャ、ジェフユナイテッド千葉、東京ヴェルディ1969、FC町田ゼルビア、ツエーゲン金沢、ファジアーノ岡山、レノファ山口FC、V・ファーレン長崎、ロアッソ熊本、FC琉球、いわてグルージャ盛岡、ブラウブリッツ秋田（22→20クラブに整理）

**J3（20クラブ）**
- 追加: 栃木SC、ザスパ群馬（旧ザスパクサツ群馬）、レイラック滋賀FC、FC大阪、奈良クラブ、愛媛FC、高知ユナイテッドSC、鹿児島ユナイテッドFC、FC琉球
- 削除: ヴァンラーレ八戸、いわてグルージャ盛岡、ブラウブリッツ秋田、ベガルタ仙台、Y.S.C.C.横浜、アスルクラロ沼津、藤枝MYFC、FC今治（18→20クラブに整理）

---

## 質問

設定画面にHOMEチームの選択肢を編集する項目がありますが、アウェイチームの選択も追加したいです。
設定のイメージとしたは、J1,J2,J3のレベルで選択が可能で、選択しているリーグに所属しているチームを予定入力時に選択できる
で実現したいです。

---

## 回答

*settings_screen.dart, match_form_screen.dart, preferences_service.dart, app_settings.dart を確認*

以下の方針で実装しました。

- リーグ選択（J1/J2/J3）を `AppSettings` に追加し、設定変更を即時反映
- `match_form_screen.dart` で `AppSettings.selectedLeagues` に基づいて対戦相手リストを動的生成
- 「その他」は常に表示

**`preferences_service.dart`**
- `_keySelectedLeagues = 'selected_leagues'` キーを追加
- `getSelectedLeagues()` / `setSelectedLeagues()` を追加
- デフォルトは `['j1', 'j2', 'j3']`（全リーグ）

**`app_settings.dart`**
- `_selectedLeagues` フィールドと `selectedLeagues` getter を追加
- `load()` に `getSelectedLeagues()` を追加
- `setSelectedLeagues()` メソッドを追加（`notifyListeners()` → 即時反映）

**`settings_screen.dart`**
- チーム設定カード内に「対戦相手のリーグ」セクションを追加
- J1/J2/J3 の `CheckboxListTile` 3つ
- `AppSettings.of(context)` 経由で即時反映

**`match_form_screen.dart`**
- `AppSettings` を import
- `_getAvailableAwayTeams(selectedLeagues)` メソッドを追加
- `build()` 内で `AppSettings.of(context).selectedLeagues` を取得してリストを生成
- 編集時: 保存済みの対戦相手がフィルタ外でもリストに含めて互換性確保
- 得点者ダイアログも同じフィルタ済みリストを使用
- `_getGoalScorerTeamOptions()` を引数ありに変更

*flutter analyze で検証 → 新規エラーなし（既存 info 3件のみ）*

---

## 質問

対戦相手のリストに日本代表は入ってなくてもよいかもです。
上記の修正だけおこなってここまでの内容を議事録に残してください

---

## 回答

*match_form_screen.dart, team_constants.dart を修正*

`_getAvailableAwayTeams()` 内と `allOpponentTeams` getter から「日本代表」を削除しました。

*flutter analyze で検証 → 新規エラーなし（既存 info 3件のみ）*

---
